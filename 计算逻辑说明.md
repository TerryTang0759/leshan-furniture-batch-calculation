# 🏠 乐山家具定制 - 批量投影面积计算逻辑说明

## 📋 计算逻辑概览

本系统采用标准化的柜体拆板计算逻辑，通过输入柜体的高、宽、深三个尺寸，自动计算所有材质的投影面积单价。

## 🔢 输入参数

### 必需参数
- **柜体高度** (mm): 柜体的垂直高度
- **柜体宽度** (mm): 柜体的水平宽度  
- **柜体深度** (mm): 柜体的进深尺寸

### 示例输入
```
高度: 2400mm
宽度: 1800mm
深度: 600mm
```

## 📐 自动隔板计算

### 计算公式
系统根据行业标准自动计算隔板数量：

```
横隔板数量 = ⌊高度 ÷ 400⌋ + 1
纵隔板数量 = ⌊宽度 ÷ 1000⌋ + 1
```

### 计算示例
```
横隔板数量 = ⌊2400 ÷ 400⌋ + 1 = ⌊6⌋ + 1 = 7块
纵隔板数量 = ⌊1800 ÷ 1000⌋ + 1 = ⌊1⌋ + 1 = 2块
```

### 说明
- **横隔板**: 包含顶板和底板，每400mm高度增加一块隔板
- **纵隔板**: 包含左右最外侧侧板，每1000mm宽度增加一块隔板
- **⌊⌋**: 表示向下取整（地板函数）

## 🏗️ 拆板面积计算

### 计算公式
柜体拆板总面积 = 顶板+底板 + 左右侧板 + 背板 + 横隔板 + 竖隔板

### 详细计算
```
顶板+底板 = 2 × (宽度 × 深度)
左右侧板 = 2 × (深度 × 高度)
背板 = 宽度 × 高度
横隔板 = 横隔板数量 × (宽度 × 深度)
竖隔板 = 竖隔板数量 × (深度 × 高度)
```

### 计算示例
```
顶板+底板 = 2 × (1.8m × 0.6m) = 2.1600㎡
左右侧板 = 2 × (0.6m × 2.4m) = 2.8800㎡
背板 = 1.8m × 2.4m = 4.3200㎡
横隔板 = 7 × (1.8m × 0.6m) = 7.5600㎡
竖隔板 = 2 × (0.6m × 2.4m) = 2.8800㎡
拆板总面积 = 2.1600 + 2.8800 + 4.3200 + 7.5600 + 2.8800 = 19.8000㎡
```

## 💰 投影面积单价计算

### 计算公式
```
投影面积 = 宽度 × 高度
拆板总价 = 拆板总面积 × 材质单价
投影面积单价 = 拆板总价 ÷ 投影面积
```

### 计算示例
```
投影面积 = 1.8m × 2.4m = 4.3200㎡
拆板总价 = 19.8000㎡ × 材质单价
投影面积单价 = 拆板总价 ÷ 4.3200㎡
```

### 具体材质示例
以"免漆板9mm"为例：
```
材质单价: ¥120/㎡
拆板总价: 19.8000㎡ × ¥120/㎡ = ¥2,376
投影面积单价: ¥2,376 ÷ 4.3200㎡ = ¥550/㎡
```

## 📊 批量计算流程

### 系统执行步骤
1. **接收输入**: 获取高、宽、深三个尺寸参数
2. **连接数据库**: 从MongoDB获取所有柜体材质价格数据
3. **计算隔板**: 根据标准公式计算横隔板和纵隔板数量
4. **计算拆板面积**: 按照拆板公式计算总面积
5. **批量计算**: 遍历所有材质，计算每种材质的投影面积单价
6. **结果排序**: 按投影面积单价从低到高排序
7. **统计汇总**: 计算平均单价、最低单价、最高单价

### 数据来源
- **材质数据**: 从MongoDB数据库获取33种柜体材质
- **价格数据**: 实时同步，确保价格准确性
- **备用机制**: 网络异常时使用内置数据

## 🎯 输出结果

### 统计信息
- **材质总数**: 33种
- **平均单价**: ¥1,852/㎡
- **最低单价**: ¥550/㎡ (免漆板9mm)
- **最高单价**: ¥4,125/㎡ (天然黑胡桃木皮25mm)

### 结果表格
| 材质名称 | 材质单价 | 拆板总价 | 投影面积单价 |
|---------|---------|---------|-------------|
| 免漆板9mm≤H2745 | ¥120/㎡ | ¥2,376 | ¥550/㎡ |
| 免漆板纯色系9mm≤H2745 | ¥120/㎡ | ¥2,376 | ¥550/㎡ |
| 混油系列9mm≤H3050 | ¥152/㎡ | ¥3,010 | ¥697/㎡ |
| ... | ... | ... | ... |

## ✅ 计算逻辑验证

### 准确性保证
- **标准化公式**: 基于行业标准的隔板计算规则
- **精确计算**: 所有计算保留4位小数精度
- **数据验证**: 输入参数有效性检查
- **结果校验**: 计算结果合理性验证

### 透明度保证
- **步骤展示**: 详细显示每个计算步骤
- **公式说明**: 清楚说明每个计算公式
- **过程可视化**: 直观展示计算过程
- **结果可追溯**: 每个结果都可追溯到具体计算过程

## 🔧 技术实现

### 后端计算引擎
- **Node.js**: 高性能JavaScript运行环境
- **MongoDB**: 云数据库存储材质价格
- **Express.js**: Web框架提供API服务
- **数学计算**: 精确的浮点数运算

### 前端展示系统
- **实时计算**: 输入变化时实时更新结果
- **可视化展示**: 清晰的步骤展示和结果表格
- **响应式设计**: 支持各种设备访问
- **用户体验**: 简洁直观的操作界面

---

**乐山家具定制** - 让投影面积计算变得透明、准确、高效！
